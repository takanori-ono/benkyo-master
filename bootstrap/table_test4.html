<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="bootstrap3/css/bootstrap.css">
</head>

<body>

    <div class="container">
        hoge
        <form action="" method="post">
            <table class="table table-striped table-hover" data-sort_table="1">
                <thead>
                    <tr>
                        <th>
                            Taisho
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="1">
                            No
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="2">
                            Weight
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="3">
                            Name
                            <span></span>
                        </th>
                        <th>
                            Value
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="1">
                            1
                        </td>
                        <td data-key_no="2" data-sort-key="30">
                            30
                        </td>
                        <td data-key_no="3" data-sort-key="Takanor Ono">
                            Takanor Ono
                        </td>
                        <td>
                            給与担当
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="2">
                            2
                        </td>
                        <td data-key_no="2" data-sort-key="4">
                            4
                        </td>
                        <td data-key_no="3" data-sort-key="Abe Takafumi">
                            Abe Takafumi
                        </td>
                        <td>
                            <a href="#" data-toggle="tooltip" title="hoge">
                                総理大臣
                            </a>
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="3">
                            3
                        </td>
                        <td data-key_no="2" data-sort-key="100">
                            100
                        </td>
                        <td data-key_no="3" data-sort-key="Ohtani Shohei">
                            Ohtani Shohei
                        </td>
                        <td>
                            党首担当
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="4">
                            4
                        </td>
                        <td data-key_no="2" data-sort-key="20">
                            20
                        </td>
                        <td data-key_no="3" data-sort-key="Takanor Ono">
                            Takanor Ono
                        </td>
                        <td>
                            給与担当(臨時)
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="20">
                            20
                        </td>
                        <td data-key_no="2" data-sort-key="40">
                            40
                        </td>
                        <td data-key_no="3" data-sort-key="Aso Group">
                            Aso Group
                        </td>
                        <td>
                            <a href="#" data-toggle="tooltip" title="hoge">
                                財務
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <button class="btn btn-primary mt-2" name="do_sort" id="do_sort">sort by name</button>
            <button class="btn btn-primary mt-2" name="do_sort_no" id="do_sort_no">sort by no</button>

            <table class="table table-striped table-hover sortable2" data-sort_table="2">
                <thead>
                    <tr>
                        <th>
                            Taisho
                            <!-- <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span> -->
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="1">
                            No
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="2">
                            Weight
                            <span></span>
                        </th>
                        <th class="sort_head" data-key_no="3">
                            Name
                            <span></span>
                        </th>
                        <th>
                            Value
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="1">
                            A
                        </td>
                        <td data-key_no="2" data-sort-key="30">
                            30
                        </td>
                        <td data-key_no="3" data-sort-key="Takanor Ono">
                            Takanor Ono
                        </td>
                        <td>
                            給与担当
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="2">
                            B
                        </td>
                        <td data-key_no="2" data-sort-key="4">
                            4
                        </td>
                        <td data-key_no="3" data-sort-key="Abe Takafumi">
                            Abe Takafumi
                        </td>
                        <td>
                            <a href="#" data-toggle="tooltip" title="ほげほげ">
                                総理大臣
                            </a>
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="3">
                            C
                        </td>
                        <td data-key_no="2" data-sort-key="100">
                            100
                        </td>
                        <td data-key_no="3" data-sort-key="Ohtani Shohei">
                            Ohtani Shohei
                        </td>
                        <td>
                            党首担当
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="4">
                            D
                        </td>
                        <td data-key_no="2" data-sort-key="20">
                            20
                        </td>
                        <td data-key_no="3" data-sort-key="Takanor Ono">
                            Takanor Ono
                        </td>
                        <td>
                            給与担当(臨時)
                        </td>
                    </tr>
                    <tr class="sortable-item">
                        <td>
                            <input type="checkbox" class="form-check-input obj_chk">
                        </td>
                        <td data-key_no="1" data-sort-key="20">
                            F
                        </td>
                        <td data-key_no="2" data-sort-key="40">
                            40
                        </td>
                        <td data-key_no="3" data-sort-key="Aso Group">
                            Aso Group
                        </td>
                        <td>
                            <a href="#" data-toggle="tooltip" title="ほげ">
                                財務
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>

    <div id="dialog-form" title="Create new user">
        <p class="validateTips">All form fields are required.</p>

        <form>
            <fieldset>
                <label for="name">Name</label>
                <input type="text" name="name" id="name" value="Jane Smith"
                    class="text ui-widget-content ui-corner-all">
                <label for="email">Email</label>
                <input type="text" name="email" id="email" value="jane@smith.com"
                    class="text ui-widget-content ui-corner-all">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" value="xxxxxxx"
                    class="text ui-widget-content ui-corner-all">

                <!-- Allow form submission with keyboard without duplicating the dialog button -->
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
        </form>
    </div>

    <script src="js/jquery.js"> </script>
    <script src="bootstrap3/js/jquery-ui-1.12.1.min.js"> </script>
    <script src="bootstrap3/js/bootstrap.js"></script>
    <script src="js/store.legacy.min.js"></script>
    <script>
        // $(window).on('load', function () {
        //     $('.sortable .name').text('hgoe');
        // });

        var tbl_no;
        var sort_key;
        var vert_key;
        const up_icon_class = 'glyphicon glyphicon-chevron-up';
        const down_icon_class = 'glyphicon glyphicon-chevron-down';

        function get_vert_from_store(t, s) {
            var k = 'table_test_vert_ary_' + t + '-' + s;
            var v = store.get(k);
            if (v === undefined) return false;
            return v;
        };
        function set_vert_from_store(t, s, v) {
            var k = 'table_test_vert_ary_' + t + '-' + s;
            store.set(k, v);
        };
        function get_prev_sort_key(t) {
            var k = 'table_test_prev_sk_' + t;
            var v = store.get(k);
            return v;
        }
        function set_prev_sort_key(t, v) {
            var k = 'table_test_prev_sk_' + t;
            var v = store.set(k, v);
        }
        function set_vert_key() {
            //vert_key = vert_ary[sort_key - 1];
            vert_key = get_vert_from_store(tbl_no, sort_key);
            var prev_key = get_prev_sort_key(tbl_no);
            if (prev_key == sort_key) {
                vert_key = !vert_key;
            }
            set_vert_from_store(tbl_no, sort_key, vert_key);
            set_prev_sort_key(tbl_no, sort_key);
        };
        $(".sort_head").on('click', function () {
            tbl_no = $(this).parents('table').data('sort_table');
            sort_key = $(this).data('key_no');
            set_vert_key();
            start_the_sort();
            change_icon($(this));
        });
        function onload_sort_table(t) {
            tbl_no = t;
            var prev_key = get_prev_sort_key(tbl_no);
            if (prev_key !== undefined) {
                sort_key = prev_key;
                vert_key = get_vert_from_store(tbl_no, sort_key);
                start_the_sort();
                change_icon($('[data-sort_table="' + tbl_no + '"] .sort_head[data-key_no="' + sort_key + '"]'));
            }
        }
        function change_icon(e) {
            remove_all_sort_icon();
            e.children('span').addClass(vert_key ? down_icon_class : up_icon_class);
        }
        function remove_all_sort_icon() {
            $('[data-sort_table="' + tbl_no + '"] .sort_head').children('span')
                .removeClass(up_icon_class)
                .removeClass(down_icon_class);
        }
        function start_the_sort() {
            $('[data-sort_table="' + tbl_no + '"] tbody').html(
                $('[data-sort_table="' + tbl_no + '"] .sortable-item').sort(function (a, b) {
                    var aa = get_sort_key_obj(a);
                    var bb = get_sort_key_obj(b);
                    var aval = $(aa).data('sort-key');
                    var bval = $(bb).data('sort-key');
                    var ans;
                    if (aval < bval) {
                        ans = -1;
                    } else if (aval > bval) {
                        ans = 1;
                    } else {
                        return 0;
                    }
                    return vert_key ? -ans : ans;
                })
            );
            $('[data-toggle="tooltip"]').tooltip();
        };
        function get_sort_key_obj(r) {
            return $(r).children('[data-key_no="' + sort_key + '"]');
        };
        $('tbody').on('click', 'tr', function () {
            var chk = $(this).find('.obj_chk');
            console.log(chk.prop('checked'));
            var v = chk.prop('checked');
            chk.prop('checked', !v);
        });
        $('tbody').on('click', '.obj_chk', function (e) {
            e.stopPropagation();
        });
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();
            onload_sort_table(1);
            onload_sort_table(2);
        });
    </script>
</body>

</html>